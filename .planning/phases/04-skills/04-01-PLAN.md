---
phase: 04-skills
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - src/skills/loader.ts
  - src/skills/index.ts
  - src/memory/home.ts
autonomous: true

must_haves:
  truths:
    - "Skills discovered from ~/.klausbot/skills/ directory"
    - "SKILL.md frontmatter parsed for name and description"
    - "Skill descriptions available for system prompt context"
  artifacts:
    - path: "src/skills/loader.ts"
      provides: "Skill discovery and loading functions"
      exports: ["discoverSkills", "loadSkillContent", "buildSkillsContext"]
    - path: "src/skills/index.ts"
      provides: "Skills module barrel export"
  key_links:
    - from: "src/skills/loader.ts"
      to: "~/.klausbot/skills/"
      via: "readdirSync + readFileSync"
      pattern: "KLAUSBOT_HOME.*skills"
---

<objective>
Create the skill discovery and loading system that finds SKILL.md files in ~/.klausbot/skills/, parses their YAML frontmatter, and builds context for Claude's system prompt.

Purpose: Foundation for skills system - Claude needs to know what skills exist before it can use them.
Output: src/skills/ module with discovery, loading, and context-building functions.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-skills/04-CONTEXT.md
@.planning/phases/04-skills/04-RESEARCH.md
@src/memory/home.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create skills loader module</name>
  <files>src/skills/loader.ts</files>
  <action>
Create src/skills/loader.ts with:

1. **SkillMeta interface:**
   ```typescript
   interface SkillMeta {
     name: string;
     description: string;
     path: string;
     disableModelInvocation: boolean;  // skill won't be auto-selected
     userInvocable: boolean;           // can user invoke directly
   }
   ```

2. **discoverSkills() function:**
   - Scan `~/.klausbot/skills/` for directories
   - For each directory, check for `SKILL.md`
   - Extract YAML frontmatter using regex (no yaml library needed):
     ```typescript
     const match = content.match(/^---\n([\s\S]*?)\n---/);
     ```
   - Parse `name:`, `description:`, `disable-model-invocation:`, `user-invocable:` fields
   - Skip skills without description (required field)
   - Return array of SkillMeta

3. **loadSkillContent(skill: SkillMeta) function:**
   - Read full SKILL.md file
   - Remove frontmatter (return body only)
   - Return skill instructions as string

4. **buildSkillsContext(skills: SkillMeta[]) function:**
   - Filter to auto-selectable skills (disableModelInvocation === false)
   - Build XML-tagged context string with 15k char budget:
     ```
     <available_skills>
     - "skill-name": description
     - "another-skill": description
     </available_skills>
     ```
   - Truncate if exceeds budget

5. **SKILLS_DIR constant:**
   - Use `join(KLAUSBOT_HOME, 'skills')` from home.ts

Use createChildLogger('skills') for logging.
  </action>
  <verify>TypeScript compiles without errors: `npx tsc --noEmit`</verify>
  <done>discoverSkills, loadSkillContent, buildSkillsContext exported and type-safe</done>
</task>

<task type="auto">
  <name>Task 2: Add skills directory to home initialization</name>
  <files>src/memory/home.ts</files>
  <action>
Add 'skills' to the DIRS array so `~/.klausbot/skills/` is created at startup:

```typescript
export const DIRS = ['config', 'conversations', 'identity', 'skills'] as const;
```

This ensures the skills directory exists before discovery runs.
  </action>
  <verify>`npx tsc --noEmit` passes</verify>
  <done>skills directory created automatically on gateway startup</done>
</task>

<task type="auto">
  <name>Task 3: Create skills barrel export</name>
  <files>src/skills/index.ts</files>
  <action>
Create src/skills/index.ts as barrel export:

```typescript
export {
  discoverSkills,
  loadSkillContent,
  buildSkillsContext,
  type SkillMeta,
} from './loader.js';
```
  </action>
  <verify>`npx tsc --noEmit` passes; `grep -r "from './skills'" src/` shows no errors</verify>
  <done>Skills module cleanly importable from src/skills/index.js</done>
</task>

</tasks>

<verification>
1. `npx tsc --noEmit` compiles without errors
2. Module imports resolve: `node -e "import('./dist/skills/index.js').then(m => console.log(Object.keys(m)))"`
3. Code review: discoverSkills handles empty directory gracefully
</verification>

<success_criteria>
- src/skills/loader.ts exports discoverSkills, loadSkillContent, buildSkillsContext
- Skills directory (skills/) added to DIRS in home.ts
- No new runtime dependencies added
- TypeScript compiles cleanly
</success_criteria>

<output>
After completion, create `.planning/phases/04-skills/04-01-SUMMARY.md`
</output>
