---
phase: 05.1-acp-streaming
plan: 03
type: execute
wave: 3
depends_on: ["05.1-02"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User sends message, response streams to Telegram in chunks"
    - "Claude calls create_cron MCP tool, cron appears in store"
    - "Claude calls list_crons MCP tool, returns job list"
    - "Claude calls delete_cron MCP tool, removes job"
    - "Existing identity, memory, skills still work"
  artifacts: []
  key_links: []
---

<objective>
Verify ACP streaming and MCP tools work end-to-end.

Purpose: Confirm the architecture change from CLI to ACP is complete and functional.
Output: Verified working system with streaming responses and typed MCP tool calls.
</objective>

<execution_context>
@/home/soham/.claude/get-shit-done/workflows/execute-plan.md
@/home/soham/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05.1-acp-streaming/05.1-01-SUMMARY.md
@.planning/phases/05.1-acp-streaming/05.1-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Start gateway and prepare test environment</name>
  <files></files>
  <action>
1. Ensure clean build:
   ```bash
   npm run build
   ```

2. Check cron store is accessible:
   ```bash
   cat ~/.klausbot/crons.json 2>/dev/null || echo '{"version":1,"jobs":[]}'
   ```

3. Start gateway in background (or user starts manually):
   ```bash
   npm start &
   ```

4. Note: User should have Telegram ready to send test messages
  </action>
  <verify>
    - Build succeeds
    - Gateway starts without errors
  </verify>
  <done>Gateway running, ready for Telegram interaction</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
ACP streaming architecture replacing CLI spawner:
- MCP server with cron tools (create_cron, list_crons, delete_cron)
- ACP client using query() async generator
- Telegram streamer with 500ms debounce
- Gateway wired to use streaming
  </what-built>
  <how-to-verify>
**Test 1: Streaming Response**
1. Send a message to the bot via Telegram: "What's 2 + 2?"
2. Watch the response appear
3. EXPECTED: Text should stream in chunks (you see partial message growing), not arrive all at once

**Test 2: Create Cron via MCP**
1. Send: "Remind me every day at 9am to drink water"
2. EXPECTED: Claude creates cron, confirms with job name and next run time
3. Verify: Check `~/.klausbot/crons.json` has new job

**Test 3: List Crons via MCP**
1. Send: "What are my scheduled tasks?"
2. EXPECTED: Claude lists the water reminder job

**Test 4: Delete Cron via MCP**
1. Send: "Delete the water reminder"
2. EXPECTED: Claude deletes the job, confirms deletion
3. Verify: `~/.klausbot/crons.json` no longer has the job

**Test 5: Existing Functionality**
1. Send: "What's my name?" (tests identity/memory)
2. EXPECTED: Bot responds with user's name from USER.md (or asks if unknown)
3. Send: "/crons" command
4. EXPECTED: Shows scheduled tasks (may be empty now)

**Pass criteria:**
- [x] Streaming visible (partial message updates)
- [x] Cron created via MCP tool
- [x] Cron listed via MCP tool
- [x] Cron deleted via MCP tool
- [x] Identity/memory still works
  </how-to-verify>
  <resume-signal>
Type "all tests pass" to complete phase, or describe issues found.
  </resume-signal>
</task>

</tasks>

<verification>
Human verification of end-to-end streaming and MCP tool functionality.
</verification>

<success_criteria>
- Streaming visibly works (messages grow incrementally)
- MCP cron tools (create, list, delete) all functional
- Existing bot functionality preserved
</success_criteria>

<output>
After completion, create `.planning/phases/05.1-acp-streaming/05.1-03-SUMMARY.md`
</output>
